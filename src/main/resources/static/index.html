<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>种植工艺库</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="./pages/index/add-more/add-more.css">

    <!-- 引入组件库 -->
    <script src="http://luopq.com/demo/lib/jquery-1.10.2.min.js"></script>
    <script src="./js/vue.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="./utils/public.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            background-color: #A3D0C3;
        }

        [v-cloak] {
            display: none;
        }

        .overHid-1 {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .wrapper {
            position: relative;
        }

        .content {
            width: 90%;
            margin: 0 auto;
        }

        .search-box {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
        }

        .search-con {
            display: flex;
        }

        .search-con .search-input {
            width: 200px;
        }

        .search-con .search-item:not(:last-child) {
            margin-right: 10px;
        }

        .pagination-box {
            display: flex;
            justify-content: center;
            margin: 10px auto 0;
        }

        .list-box .el-table td {
            padding: 4px 0;
        }
    </style>
</head>

<body>
    <div class="wrapper" v-cloak>
        <div class="content">
            <!-- 提示框 -->
            <el-alert v-if="anno" :closable="false" :title="anno" type="warning" show-icon>
            </el-alert>

            <!-- 搜索框 -->
            <div class="search-box">
                <div class="search-con">
                    <el-input class="search-item search-input" placeholder="种植工艺 / 角色名" suffix-icon="el-icon-search"
                        v-model="searchInfo.keyValue" @change="onSearch">
                    </el-input>
                    <el-select class="search-item" v-model="searchInfo.serverName" clearable @change="onSearch"
                        placeholder="请选择服务器">
                        <el-option v-for="item in serverType" :key="item.value" :label="item.label" :value="item.value">
                        </el-option>
                    </el-select>
                    <el-select class="search-item" v-model="searchInfo.sellOrBuy" clearable @change="onSearch"
                        placeholder="请选择买卖类型">
                        <el-option v-for="item in saleType" :key="item.value" :label="item.label" :value="item.value">
                        </el-option>
                    </el-select>
                </div>

                <div class="add-con">
                    <el-button class="btn" icon="el-icon-plus" type="primary" @click="onMoreAdd">批量添加</el-button>
                    <el-button class="btn" icon="el-icon-plus" type="primary" @click="onOneAdd">单个添加</el-button>
                </div>
            </div>

            <!-- 列表 -->
            <div class="list-box">
                <el-table :data="dataList" style="width: 100%">
                    <el-table-column prop="createdTime" label="创建时间" min-width="160">
                    </el-table-column>

                    <el-table-column prop="name" label="种植工艺" min-width="300">
                        <template slot-scope="scope">
                            <el-popover placement="right" title="种植工艺" width="200" trigger="hover">
                                <p>{{scope.row.name}}</p>
                                <div slot="reference" class="overHid-1">
                                    <span>{{scope.row.name}}</span>
                                </div>
                            </el-popover>
                        </template>
                    </el-table-column>

                    <el-table-column prop="roleName" label="角色名" min-width="200">
                    </el-table-column>

                    <el-table-column prop="level" label="等级">
                    </el-table-column>

                    <el-table-column prop="price" label="价格">
                        <template slot-scope="scope">
                            <span>{{scope.row.price}}/{{scope.row.unit}}</span>
                        </template>
                    </el-table-column>

                    <el-table-column prop="number" label="数量">
                    </el-table-column>

                    <el-table-column prop="sellOrBuy" label="买卖">
                    </el-table-column>

                    <el-table-column prop="serverName" label="服务器">
                    </el-table-column>

                    <el-table-column fixed="right" label="操作" width="100">
                        <template slot-scope="scope">
                            <el-button @click="onCopy(scope.row)" type="text" size="small">copy</el-button>
                            <el-button @click="onDel(scope.row)" type="text" size="small">del</el-button>
                        </template>
                    </el-table-column>

                </el-table>
            </div>

            <!-- 分页 -->
            <div class="pagination-box">
                <el-pagination background @current-change="onPaginationChange" layout="prev, pager, next"
                    :page-sizes="20" :total="totalCount" :hide-on-single-page="true">
                </el-pagination>
            </div>
        </div>

        <!-- 删除 -->
        <div class="del-dialog"></div>

        <!-- 批量添加 -->
        <div class="add-more"></div>

        <!-- 单个添加 -->
        <div class="add-one"></div>
    </div>

    <footer>
        <p style="text-align:center;">
            <a href="http://www.beian.miit.gov.cn" target="_blank"
                style="color: #999; font-size: 12px;">苏ICP备19059496号</a>
        </p>
    </footer>

    <script>
        var _wrapper = new Vue({
            el: '.wrapper',
            data() {
                return {
                    searchInfo: {
                        keyValue: '',
                        serverName: '',
                        sellOrBuy: '',
                        page: 1,
                        pageSize: 20
                    },
                    anno: '',
                    totalCount: 0,
                    dataList: [],
                    nameList: [],
                    serverType: [
                        {
                            value: '国际服',
                            label: '国际服',
                        },
                        {
                            value: '国服',
                            label: '国服',
                        },
                    ],
                    saleType: [
                        {
                            value: '卖',
                            label: '卖',
                        },
                        {
                            value: '买',
                            label: '买',
                        },
                    ],
                }
            },
            mounted() {
                // 获取列表
                this.getList()

                // 获取公告
                this.getAnno()
            },
            methods: {
                getList() {
                    $.get('/seedTrade/seed', this.searchInfo, function (res) {
                        this.dataList = res.rows

                        this.totalCount = res.totalCount
                    }.bind(this))
                },
                getAnno() {
                    $.get('/seedTrade/seed/anno', {}, function (res) {
                        this.anno = res
                    }.bind(this))
                },
                onPaginationChange(val) {
                    this.searchInfo.page = val

                    this.getList()
                },
                onSearch() {
                    this.searchInfo.page = 1

                    this.getList()
                },
                onDel(row) {
                    _delDialog.show(row.id)
                },
                onMoreAdd() {
                    _addMore.show()
                },
                onOneAdd() {
                    _addOne.show()
                },
                onCopy(row) {

                    _pub.Notify(this, { message: '您复制了一条种植工艺密钥！' })

                    var oInput = document.createElement('input')
                    oInput.setAttribute('id', 'copy')
                    oInput.value = row.whisper
                    document.getElementsByTagName('body')[0].appendChild(oInput)

                    document.getElementById('copy').select()
                    document.execCommand('Copy')
                    document.getElementById('copy').remove()
                },
            },
        })
    </script>

    <script src="./pages/index/del-dialog/del-dialog.js"></script>
    <script src="./pages/index/add-more/add-more.js"></script>
    <script src="./pages/index/add-one/add-one.js"></script>

</body>

</html>